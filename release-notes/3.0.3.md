# Minitrino Release Notes: 3.0.3

## Release Overview

Minitrino 3.0.3 is a patch release that fixes a critical bug preventing the CLI
from working when installed from PyPI without a pre-existing library, and adds
automated smoke testing to catch similar issues in future releases.

**Key improvements:**

- Fixed `lib-install` and `config` commands failing when no library is installed
- Added minimal initialization mode for commands that don't require a library
- Added cross-platform PyPI smoke test workflow (Ubuntu + macOS)

**Table of Contents:**

- [CLI Changes and Additions](#cli-changes-and-additions)
- [Other](#other)

## CLI Changes and Additions

### Bug Fix: Commands Failing Without Library Installed

Fixed a critical bug where `minitrino lib-install` and `minitrino config`
commands would fail with "This operation requires a library to be installed"
error when run on a fresh installation from PyPI.

**Root cause:** During context initialization, the `_compare_versions()` method
was called unconditionally, which accessed `lib_dir`, which raised an error if
no library was found. This created a chicken-and-egg problem where users
couldn't install the library because the command to install it required a
library to already exist.

**The fix:**

- Renamed `_compare_versions()` to `_try_compare_versions()` and wrapped it in
  try/except to gracefully handle missing libraries
- Added `minimal=True` parameter to `initialize()` that skips library-dependent
  operations (module loading, cluster setup, Docker client initialization)
- Updated `lib-install` and `config` commands to use minimal initialization

This bug only affected users installing from PyPI into an isolated environment.
Users running from the repository or with an existing library were not affected
because the fallback logic found `src/lib/` in the repo tree.

## Other

### CI/CD: Integrated Smoke Test as Release Gate

Restructured the release workflow to use the smoke test as a **gate** before
creating the GitHub release. The new flow is:

1. **PyPI Publish** - Package is built and uploaded to PyPI
1. **Smoke Test** - Cross-platform tests verify the PyPI package works
1. **GitHub Release** - Only created if smoke test passes

This ensures that if the smoke test fails, the PyPI package exists but no
official GitHub release is created, preventing broken releases from being
announced.

**Smoke test features:**

- **Truly isolated testing**: Does NOT checkout the repository, simulating an
  end-user installation experience
- **Cross-platform coverage**: Runs on both Ubuntu 22.04 and macOS 13
- **Comprehensive command testing**:
  - `minitrino config --reset` (without library - validates the bug fix)
  - `minitrino lib-install` (without library - validates the bug fix)
  - `minitrino modules` (with library)
  - `minitrino provision` with 30-second timeout (validates Docker integration)

### CI/CD: CLI Integration Test Sharding

Split the CLI integration tests into 4 parallel jobs to reduce CI bottleneck:

| Job       | Tests | Description             |
| --------- | ----- | ----------------------- |
| Provision | 10    | `test_cmd_provision.py` |
| Snapshot  | 8     | `test_cmd_snapshot.py`  |
| Remove    | 7     | `test_cmd_remove.py`    |
| Other     | 12    | Remaining 9 test files  |

Previously, "Other" ran 37 tests while "Provision" ran only 10, causing a
significant bottleneck. The new distribution (10/8/7/12) provides better
parallelization.

Closes #144.
