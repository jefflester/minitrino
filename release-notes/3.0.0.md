# Minitrino Release Notes: 3.0.0

## Release Overview

Minitrino 3.0.0 represents a **major evolution** of the project, transforming it
from a Starburst-only tool into a universal local cluster management solution
for the entire Trino ecosystem. This release delivers game-changing capabilities
including **native Trino support**, **multi-cluster orchestration**, and a
completely modernized architecture built for production-grade developer
experiences.

**Highlights:**

- ðŸŽ‰ **Trino Support**: Full compatibility with Trino 443+ alongside Starburst
  443-e+
- ðŸš€ **Multi-Cluster**: Deploy and manage multiple isolated clusters
  simultaneously
- ðŸ—ï¸ **Modernized Architecture**: Complete overhaul with Python 3.10+,
  pyproject.toml, and enhanced modularity
- ðŸ“Š **Production Logging**: Advanced logging system with spinners, buffering,
  and colored output
- ðŸ“š **Comprehensive Docs**: Full Sphinx documentation site with API references
  and user guides
- ðŸ§ª **Testing Overhaul**: Enhanced test infrastructure with better coverage and
  organization

**By the Numbers:**

- ~300 commits since release 2.2.4
- 500+ files changed
- 28k+ lines added
- 8k+ lines removed
- 26 new core Python modules
- 37 modules across admin, catalog, and security categories

**Table of Contents:**

- [Breaking Changes & Upgrade Guide](#breaking-changes--upgrade-guide)
- [CLI Changes and Additions](#cli-changes-and-additions)
- [Library Changes and Additions](#library-changes-and-additions)
- [Other](#other)

---

## Breaking Changes & Upgrade Guide

âš ï¸ **Important**: This release contains breaking changes. Please review this
section carefully before upgrading.

### 1. Trino Support & Configuration Changes

Minitrino now supports both Trino and Starburst distributions. This requires
configuration updates:

**Environment Variable Changes:**

- `STARBURST_VER` â†’ `CLUSTER_VER` (version of Trino/Starburst)
- New `IMAGE` variable required: Set to `trino` or `starburst` (maps to
  `CLUSTER_DIST` internally)
- `ETC = "/etc/starburst"` â†’ `ETC = "/etc/${CLUSTER_DIST}"` (now dynamic
  based on distribution)

**Action Required:** Update your `~/.minitrino/minitrino.cfg` file with:

```bash
CLUSTER_VER=476      # or your preferred version
IMAGE=trino          # or 'starburst'
```

### 2. Python Version Requirement

**Minimum Python version increased from 3.8 to 3.10.**

**Action Required:** Upgrade Python if needed: `python --version`

### 3. Project Structure Refactor (#125)

Major reorganization of the codebase:

- **setup.py â†’ pyproject.toml**: Modern Python packaging standards
- **Command files renamed**: `cmd_*.py` â†’ `*.py` (e.g., `cmd_provision.py` â†’
  `provision.py`)
- **Core reorganized**: New subdirectories `core/cluster/`, `core/docker/`,
  `core/logging/`, `core/exec/`

**Action Required:** If you import Minitrino modules directly, update import
paths.

### 4. Bootstrap & Entrypoint Changes

The container bootstrap lifecycle has been rewritten with new before/after
hooks.

**Action Required:** Custom modules with bootstrap scripts must be updated to
use the new API. See the module development documentation.

### 5. Docker Labels Changed

- **Previous**: `com.starburst.tests=minitrino`
- **Now**: `org.minitrino.root=true` and `org.minitrino.module`

**Action Required:** Update any scripts that filter by Docker labels.

### 6. Container Image Naming

Container image naming has changed to support both distributions:

- **Previous**: `minitrino/trino:${STARBURST_VER}`
- **Now**: `minitrino/cluster:${CLUSTER_VER}-${CLUSTER_DIST}`

**Action Required:** Update any scripts or configurations that reference the old image name.

### 7. CLI Option Changes

- `--docker-native` flag removed; image builds now happen automatically when
  needed
- Build is triggered automatically when: (1) the image doesn't exist, or (2)
  the image source has changed
- Configuration file format updated

**Action Required:** Remove `--docker-native` from any scripts (no replacement
needed).

### Upgrade Steps

1. **Upgrade Python** to 3.10 or higher if needed
2. **Update configuration file** (`~/.minitrino/minitrino.cfg`) with new
   variables
3. **Install 3.0.0**: `pip install --upgrade minitrino`
4. **Install library**: `minitrino lib-install` (auto-prompted if needed)
5. **Test with new syntax**: `minitrino -c test provision` to verify
6. **Update custom modules** if you have any

---

## CLI Changes and Additions

### New Commands

- **`restart`**: Restart cluster containers without full reprovisioning
- **Enhanced `resources`**: View cluster resources with filters (`--container`,
  `--volume`, `--image`, `--network`)
- **Enhanced `exec`**: Improved container command execution with interactive
  shell support (`-i` flag), container selection, and user specification

### Multi-Cluster Support

- **`--cluster` / `-c` flag**: Deploy and manage multiple isolated clusters
  simultaneously
- **Shared networking**: Cross-cluster communication via shared cluster networks
- **Independent lifecycles**: Each cluster operates independently with its own
  resources
- **Example**: `minitrino -c prod provision --modules hive,iceberg` + `minitrino
  -c dev provision --modules postgres`

### Library Management

- **LibraryManager class**: Automated library installation and version
  management (#103)
- **Auto-install/upgrade**: Automatically installs library if missing or prompts
  for upgrade on version mismatch
- **`--list-releases`**: View available Minitrino library releases
- **Smart detection**: CLI detects library/version mismatches and guides users

### Logging System Overhaul

- **Complete rewrite** using Python's native logging facility
- **Colored output**: Terminal-aware formatting with severity-based colors
- **Spinner integration**: User feedback during long-running operations
- **Better buffering**: Output buffering during spinner display
- **Log levels**: Configurable logging with `--log-level` flag
- **Improved tracebacks**: Enhanced error reporting with full stack traces

### Port Management

- **ClusterPortManager**: Automatic port conflict resolution across clusters
- **Dynamic assignment**: Intelligent port allocation with increment logic
- **Circular dependency handling**: Resolves complex multi-cluster port
  dependencies

### Command Execution Framework

- **New `core/exec/` package**: Structured command execution (host and
  container)
- **Shell auto-detection**: Automatically detects available shell in containers
- **Environment propagation**: Cluster environment variables passed to exec
  commands
- **Better error handling**: Clear error messages for failed commands

### Configuration & Validation

- **Enhanced validation**: Pre-flight checks before cluster provisioning
- **Config suggestions**: Helpful hints using difflib for typos
- **Secret scrubbing**: Automatic scrubbing of sensitive data (keys, passwords,
  tokens) in logs

### Other CLI Improvements

- **Automatic image builds**: No longer need `--docker-native --build`; images
  build automatically when missing or outdated
- Updated Click dependency to 8.1.8
- Better exception handling with structured error types
- Improved snapshot functionality
- Enhanced user feedback and progress indicators
- Cross-platform Docker socket resolution

---

## Library Changes and Additions

### New Modules

**Admin Modules:**

- **`minio`**: Standalone MinIO object storage module (extracted from dependent
  modules)
- **`ldap-group-provider`**: LDAP group provider integration
- **`spooling-protocol`**: Spooling protocol support
- **`starburst-gateway`**: Starburst Gateway orchestration
- **`scim`**: System for Cross-domain Identity Management (SCIM) integration

**Catalog Modules:**

- **`stargate`**: Stargate connector for cross-cluster queries
- **`stargate-parallel`**: Parallel Stargate connector
- **`iceberg-hms`**: Iceberg with Hive Metastore support

**Security Modules:**

- **`jwt`**: JSON Web Token (JWT) authentication
- **`kerberos`**: Kerberos authentication support

### Module Updates & Improvements

- **All MinIO-dependent modules** refactored to use standalone `minio` module
  (#99, #100)
- **OAuth2 module** enhanced with user management and group claims
- **Cache service** improvements and bug fixes (`results-cache` module)
- **LDAP module** updated with group information support
- **TLS module** fixed for multi-cluster environments
- **BIAC module** bootstrap updated to create `_stub` role
- **Faker module** improvements and compatibility updates

### Container Image Enhancements

- **Multi-stage Dockerfile**: Optimized build with better layer caching
- **SDKMAN integration**: Flexible Java version management
- **Java 24 support**: Added mapping for newer Java releases
- **Rich toolset**: Included curl, jq, netcat, vim, and other utilities
- **Non-root execution**: Service user for enhanced security
- **Safe JVM heap defaults**: Configurable heap settings with safe defaults
- **Dynamic tarball download**: Distribution-aware Trino/Starburst tarball
  fetching
- **Architecture detection**: Automatic CPU architecture detection for correct
  tarball selection (#97)

### Cluster Orchestration

- **ClusterProvisioner**: Centralized cluster deployment orchestration
- **ClusterValidator**: Pre-flight validation with comprehensive checks
- **Better health checks**: Improved container readiness detection
- **Coordinator polling**: Enhanced startup detection with fail-fast behavior
- **Worker provisioning fix**: Resolved deadlock issues during worker startup
- **Container name resolution**: Better handling of worker container names

### Module System Improvements

- **JSON schema validation**: Strict validation of module `metadata.json` files
- **Dependency resolution**: Enhanced module dependency and incompatibility
  handling
- **Module labeling**: Better tracking with `org.minitrino.module` labels
- **Additive labels**: Multi-module containers properly labeled
- **`default_env_keys`**: Support for default environment variables in metadata
- **Enterprise detection**: Automatic identification of Starburst Enterprise
  modules

### Configuration & Environment

- **Hierarchical merging**: User args > env vars > config files > defaults
- **Type consistency**: All environment variables normalized to strings
- **Docker Compose integration**: Enhanced variable interpolation and
  substitution
- **Module-specific variables**: Dynamic injection of module-specific
  configuration
- **Native S3 filesystem support**: Compatibility layer for legacy and native S3
  filesystems (>= 458 releases)

### Version Updates

- **Minimum version**: Changed to Trino 443+ / Starburst 443-e+
- **Default version**: Updated to 476 (Trino)

---

## Other

### Documentation

- **Complete Sphinx documentation site** with modern PyData theme
- **Auto-generated API documentation** for all modules
- **User guides**: Installation, workflow examples, troubleshooting
- **Developer guides**: Module development, testing, GitHub workflows
- **Module documentation**: Comprehensive docs for all 37 modules
- **ReadTheDocs integration** with version switcher
- **Docker-based docs server**: `make docs-up` for local preview

### Testing Infrastructure

- **Restructured test package**: `test/` â†’ `tests/` with new subdirectory
  organization:
  - `tests/cli/integration_tests/` - End-to-end CLI workflows
  - `tests/cli/unit_tests/` - Component unit tests
  - `tests/lib/` - Library and module tests
- **MinitrinoExecutor class**: Consistent CLI testing utilities in `common.py`
- **Enhanced integration tests**: End-to-end CLI workflow testing with dataclass
  scenarios
- **Better Docker management**: Improved daemon lifecycle in tests
- **Separate workflows**: Dedicated CI workflows for Trino vs Starburst testing
- **Coverage integration**: pytest-cov for code coverage reporting
- **Library test improvements**: Better test runner with enhanced observability
- **Test JSON updates**: Module test definitions updated and validated

### Code Quality & Tooling

- **Expanded pre-commit hooks**: shellcheck, yamllint, mdformat, auto-generated
  docs
- **Makefile**: Project-level Makefile with common tasks (`install`,
  `pre-commit`, `docs`, `tests`)
- **Black formatting**: Consistent code style across project
- **isort**: Automatic import sorting
- **mypy**: Strict type checking enforcement
- **flake8**: Enhanced linting rules
- **pydocstyle**: Docstring quality validation

### CI/CD Improvements

- **GitHub Actions updates**: Enhanced workflows for CLI and library tests
- **Pre-commit in CI**: Automated code quality checks
- **Separate test workflows**: Independent Trino and Starburst test pipelines
- **Automated versioning**: Synchronized version file updates
- **Release automation**: Streamlined release process

### Dependency Updates

- **New dependencies**: `humanize`, `jsonschema`, `python-dateutil`, `tabulate`
- **Updated dependencies**: Click 8.1.8, docker 7.1.0, requests >= 2.32.2
- **Development dependencies**: Enhanced tooling for docs and type checking
- **Modern packaging**: pyproject.toml with Poetry-style configuration

### Performance & Optimization

- **Faster Docker operations**: Optimized stop functionality with better
  timeouts
- **Multi-stage builds**: Reduced image size and build time
- **Parallel operations**: Concurrent operations where possible
- **Better threading**: Improved shutdown handling and coordination
- **Reduced startup time**: Optimized bootstrap orchestration

### Security Enhancements

- **Non-root containers**: Service user execution after root initialization
- **Secret scrubbing**: Automatic removal of sensitive data from logs
- **Tarball extraction**: Safe extraction with `fully_trusted` filter
- **TLS improvements**: Enhanced certificate and encryption support

### Project Structure

- **Release notes archive**: Historical release notes moved to
  `release-notes/archive/`
- **Template system**: Standardized release notes template
- **Better .gitignore**: Improved file exclusions
- **ReadTheDocs config**: Added `.readthedocs.yaml` configuration

---

## Acknowledgments

This massive release represents months of development work to modernize
Minitrino and expand its capabilities. Special thanks to all contributors and
users who provided feedback and helped shape this release.

For detailed migration guidance, troubleshooting, and usage examples, please
visit the [official documentation](https://docs.minitrino.io).
