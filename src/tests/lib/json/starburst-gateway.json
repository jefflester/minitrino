{
  "skipCi": true,
  "tests": [
    {
      "type": "shell",
      "name": "Ensure replicated cluster is running",
      "container": "minitrino-lib-test",
      "command": "echo 'pass'",
      "exitCode": 0,
      "healthcheck": {
        "command": "curl -s -k minitrino-lib-test-dep-starburst-gateway-replica:8080/v1/info || true",
        "container": "minitrino-lib-test",
        "retries": 60,
        "exitCode": 0,
        "contains": [
          "\"starting\":false"
        ]
      }
    },
    {
      "type": "query",
      "name": "Test select query in main cluster",
      "sql": "SELECT * FROM tpch.tiny.customer LIMIT 10",
      "trinoCliArgs": [
        "--server 'http://localhost:8080'",
        "--user admin"
      ],
      "retries": 10,
      "contains": [
        "custkey",
        "name",
        "address"
      ]
    },
    {
      "type": "query",
      "name": "Test select query in replicated cluster",
      "sql": "SELECT * FROM tpch.tiny.customer LIMIT 10",
      "trinoCliArgs": [
        "--server 'http://minitrino-lib-test-dep-starburst-gateway-replica:8080'",
        "--user admin"
      ],
      "retries": 30,
      "contains": [
        "custkey",
        "name",
        "address"
      ]
    },
    {
      "type": "query",
      "name": "Test select query through the gateway endpoint",
      "sql": "SELECT * FROM tpch.tiny.customer LIMIT 10",
      "trinoCliArgs": [
        "--server 'http://starburst-gateway-lib-test:9080'",
        "--user admin"
      ],
      "retries": 10,
      "contains": [
        "custkey",
        "name",
        "address"
      ]
    }
  ]
}
