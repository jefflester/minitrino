version: "3.8"

services:
  trino:
    volumes:
      - "./modules/security/system-ranger/resources/trino/ranger/:/tmp/ranger/"
      - "./modules/security/system-ranger/resources/trino/access-control.properties:/etc/starburst/access-control.properties"
    environment:
      MINITRINO_BOOTSTRAP: "bootstrap-ranger.sh"

  ranger-admin:
    image: harbor.starburstdata.net/starburstdata/starburst-ranger-admin:${SEP_RANGER_VER}
    container_name: ranger-admin
    environment:
      WAIT_FOR: ranger-postgres:5432
    env_file:
      - "./modules/security/system-ranger/resources/ranger-admin/ranger-admin.env"
    depends_on:
      - ranger-postgres
    labels:
      - "com.starburst.tests=minitrino"
      - "com.starburst.tests.module.system-ranger=security-system-ranger"
    ports:
      - 6080:6080

  ranger-postgres:
    image: library/postgres:${POSTGRES_RANGER_VER}
    container_name: ranger-postgres
    env_file:
      - "./modules/security/system-ranger/resources/ranger-admin/ranger-postgres.env"
    volumes:
      - ranger-system-postgres-data:/var/lib/postgresql/data
    labels:
      - "com.starburst.tests=minitrino"
      - "com.starburst.tests.module.system-ranger=security-system-ranger"

volumes:
  ranger-system-postgres-data:
    labels:
      - "com.starburst.tests=minitrino"
      - "com.starburst.tests.module.system-ranger=security-system-ranger"
