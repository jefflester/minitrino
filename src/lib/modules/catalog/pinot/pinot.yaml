---
services:

  minitrino:
    volumes:
      - ./modules/catalog/pinot/resources/cluster/pinot.properties:/mnt/etc/catalog/pinot.properties:ro

  pinot-zookeeper:
    image: zookeeper:${ZOOKEEPER_VER}
    container_name: pinot-zookeeper-${CLUSTER_NAME}
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    ports:
      - :2181
    volumes:
      - pinot-zookeeper-data:/data
      - pinot-zookeeper-datalog:/datalog
    labels:
      - org.minitrino=root
      - org.minitrino.module.pinot=catalog-pinot

  pinot-controller:
    image: apachepinot/pinot:${PINOT_VER}
    container_name: pinot-controller-${CLUSTER_NAME}
    command: StartController -zkAddress pinot-zookeeper:2181
    restart: unless-stopped
    environment:
      MINITRINO_BOOTSTRAP: bootstrap-pinot.sh
    env_file:
      - ./modules/catalog/pinot/resources/pinot/controller.env
    depends_on:
      - pinot-zookeeper
    ports:
      - ${__PORT_PINOT_CONTROLLER}:9000
    volumes:
      - pinot-controller-data:/tmp/data/PinotController
    labels:
      - org.minitrino=root
      - org.minitrino.module.pinot=catalog-pinot

  pinot-broker:
    image: apachepinot/pinot:${PINOT_VER}
    container_name: pinot-broker-${CLUSTER_NAME}
    command: StartBroker -zkAddress pinot-zookeeper:2181
    restart: unless-stopped
    env_file:
      - ./modules/catalog/pinot/resources/pinot/broker.env
    depends_on:
      - pinot-controller
    ports:
      - :8099
    labels:
      - org.minitrino=root
      - org.minitrino.module.pinot=catalog-pinot

  pinot-server:
    image: apachepinot/pinot:${PINOT_VER}
    container_name: pinot-server-${CLUSTER_NAME}
    command: StartServer -zkAddress pinot-zookeeper:2181
    restart: unless-stopped
    env_file:
      - ./modules/catalog/pinot/resources/pinot/server.env
    depends_on:
      - pinot-broker
    ports:
      - :8098
    volumes:
      - pinot-server-data:/tmp/data/pinotServerData
    labels:
      - org.minitrino=root
      - org.minitrino.module.pinot=catalog-pinot

volumes:
  pinot-zookeeper-data:
    labels:
      - org.minitrino=root
      - org.minitrino.module.pinot=catalog-pinot
  pinot-zookeeper-datalog:
    labels:
      - org.minitrino=root
      - org.minitrino.module.pinot=catalog-pinot
  pinot-controller-data:
    labels:
      - org.minitrino=root
      - org.minitrino.module.pinot=catalog-pinot
  pinot-server-data:
    labels:
      - org.minitrino=root
      - org.minitrino.module.pinot=catalog-pinot
