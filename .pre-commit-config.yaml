---
repos:
  - repo: https://github.com/psf/black
    rev: 25.1.0
    hooks:
      - id: black

  - repo: https://github.com/pycqa/flake8
    rev: 7.3.0
    hooks:
      - id: flake8
        args: [
          "--max-line-length", "88",
          "--ignore", "E203,W503",
          "--exclude", "__pycache__,.git,venv,build,dist",
          "src/"
        ]

  - repo: https://github.com/pycqa/isort
    rev: 6.0.1
    hooks:
      - id: isort

  - repo: https://github.com/executablebooks/mdformat
    rev: 0.7.22
    hooks:
      - id: mdformat
        files: ^docs/
        exclude: docs/index.md

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.16.1
    hooks:
      - id: mypy
        additional_dependencies:
          - mypy-extensions
          - types-click
          - types-docker
          - types-PyYAML
          - types-jsonschema
          - types-setuptools
          - types-tabulate
          - types-python-dateutil
        exclude: docs/conf.py

  # npm install --save-dev prettier
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        files: ^docs/.*\\.md$
        args: ["--prose-wrap", "always", "--print-width", "80"]

  - repo: https://github.com/pycqa/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        additional_dependencies: [tomli]
        exclude: docs/conf.py

  # brew install shellcheck (or: sudo apt-get install shellcheck, etc.)
  - repo: https://github.com/koalaman/shellcheck-precommit
    rev: v0.10.0
    hooks:
      - id: shellcheck
        name: shellcheck
        entry: shellcheck
        language: system
        types: [shell]

  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint

  # brew install jq (or: sudo apt-get install jq, etc.)
  - repo: local
    hooks:
      - id: jq-format
        name: Format JSON with jq
        entry: |-
          bash -c '
          modified=()
          for file in $(
            find src/ -type d -name ".*" -prune -o -name "*.json" -print
          ); do
            tmpfile=$(mktemp)
            if ! jq . "$file" > "$tmpfile"; then
              echo "Failed to process $file"
              exit 1
            fi
            if ! cmp -s "$file" "$tmpfile"; then
              mv "$tmpfile" "$file"
              echo "$file"
              modified+=("$file")
            else
              rm "$tmpfile"
            fi
          done
          echo "Total modified JSON files: ${#modified[@]}"
          '
        language: system
        files: \.json$
        always_run: true
        pass_filenames: false

  - repo: local
    hooks:
      - id: sync-cluster-version
        name: Sync cluster version across files
        entry: python .precommit/sync_cluster_version.py
        language: python
        files: ^src/lib/minitrino.env|src/lib/docker-compose.yaml|src/cli/minitrino/settings.py
