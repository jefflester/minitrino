---
repos:
  - repo: https://github.com/psf/black
    rev: 25.1.0
    hooks:
      - id: black

  - repo: https://github.com/pycqa/flake8
    rev: 7.2.0
    hooks:
      - id: flake8
        args: [
          "--max-line-length", "88",
          "--ignore", "E203,W503",
          "--exclude", "__pycache__,.git,venv,build,dist",
          "src/"
        ]

  - repo: https://github.com/pycqa/isort
    rev: 6.0.1
    hooks:
      - id: isort

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.16.1
    hooks:
      - id: mypy
        additional_dependencies:
          - mypy-extensions
          - types-click
          - types-docker
          - types-PyYAML
          - types-jsonschema
          - types-setuptools
          - types-tabulate
          - types-python-dateutil

  - repo: https://github.com/pycqa/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        additional_dependencies: [tomli]

  - repo: https://github.com/koalaman/shellcheck-precommit
    rev: v0.10.0
    hooks:
      - id: shellcheck
        name: shellcheck
        entry: shellcheck
        language: system
        types: [shell]

  - repo: https://github.com/adrienverge/yamllint
    rev: v1.37.1
    hooks:
      - id: yamllint
        args: ["src/"]

  - repo: local
    hooks:
      - id: jq-format
        name: Format JSON with jq
        entry: |-
          bash -c '
          modified=()
          for file in $(
            find src/ -type d -name ".*" -prune -o -name "*.json" -print
          ); do
            tmpfile=$(mktemp)
            if ! jq . "$file" > "$tmpfile"; then
              echo "Failed to process $file"
              exit 1
            fi
            if ! cmp -s "$file" "$tmpfile"; then
              mv "$tmpfile" "$file"
              echo "$file"
              modified+=("$file")
            else
              rm "$tmpfile"
            fi
          done
          echo "Total modified JSON files: ${#modified[@]}"
          '
        language: system
        files: \.json$
        always_run: true
        pass_filenames: false
