---
services:

  minitrino:
    environment:
      INSIGHTS_CONFIG_PROPERTIES: |-
        insights.jdbc.url=$${ENV:INSIGHTS_JDBC_URL}
        insights.jdbc.user=admin
        insights.jdbc.password=trinoRocks15
        insights.persistence-enabled=true
        insights.metrics-persistence-enabled=true
      # Expose as environment variable to allow external clusters to leverage
      # the same Insights backend service
      INSIGHTS_JDBC_URL: jdbc:postgresql://postgres-backend-svc-${CLUSTER_NAME}:5432/sep
    volumes:
      - ./modules/admin/insights/resources/cluster/backend_svc.properties:/mnt/etc/catalog/backend_svc.properties:ro

  postgres-backend-svc:
    image: postgres:${POSTGRES_SEP_BACKEND_SVC_VER}
    container_name: postgres-backend-svc-${CLUSTER_NAME}
    env_file:
      - ./modules/admin/insights/resources/postgres/postgres.env
    volumes:
      - postgres-insights-data:/var/lib/postgresql/data
    labels:
      - org.minitrino.root=true
      - org.minitrino.module.admin.insights=true

volumes:
  postgres-insights-data:
    labels:
      - org.minitrino.root=true
      - org.minitrino.module.admin.insights=true
